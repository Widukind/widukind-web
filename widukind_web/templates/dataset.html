{% extends "layout.html" %}

{% block title %}{{super()}} - Dataset - {{dataset.dataset_code}}{% endblock %}

{% block breadcrumb %}
    <ol class="breadcrumb">
      <li><a href="{{ url_for("home") }}">Home</a></li>
      <li><a href="{{ url_for("views.providers") }}">Providers</a></li>      
      <li><a href="{{ url_for("views.datasets", provider=dataset.provider_name) }}">{{dataset.provider_name}}</a></li>
      <li class="active">{{dataset.dataset_code}}</li>
    </ol>
{% endblock %}

{% block page %}

<a name="home"></a>
<div class="panel panel-default">
    <table class="table table-striped table-condensed table-responsive">
        <tbody>
            <tr>
                <td class="col-md-2">Provider</td>
                <td class="col-md-10">{{ provider.long_name }}</td>
            </tr>
            <tr>
                <td class="col-md-2">Name</td>
                <td class="col-md-10">{{ dataset.name }}</td>
            </tr>
            <tr>
                <td class="col-md-2">Web Site</td>
                <td class="col-md-10">
                    {% if dataset.doc_href %}
                        <a href="{{ dataset.doc_href }}">{{ dataset.doc_href }}</a>
                    {% else %}
                    &nbsp;
                    {% endif %}                
                </td>
            </tr>
            <tr>
                <td class="col-md-2">Series</td>
                <td class="col-md-10">
                    <a href="{{ url_for('.series_with_dataset_code', provider=dataset.provider_name, dataset_code=dataset.dataset_code) }}"> 
                        <span class="human-number">{{count}}</span>
                    </a>
                </td>
            </tr>
            {#
            <tr>
                <td class="col-md-2">Export</td>
                <td class="col-md-10">
                    <a title="Export CSV" class="icon" href="{{ url_for('download.datasets_csv', provider=dataset.provider_name, dataset_code=dataset.dataset_code) }}">
                        <i class="fa fa-download fa-lg"></i>
                    </a>                        
                </td>                
            </tr>
            #}
            <tr>
                <td class="col-md-2">Last Updated</td>
                <td class="col-md-10">{{ moment(dataset.last_update).format('LLL') }} ({{ moment(dataset.last_update).fromNow()}})</td>
            </tr>
            <tr>
                <td class="col-md-2">Last Download</td>
                <td class="col-md-10">{{ moment(dataset.download_last).format('LLL') }} ({{ moment(dataset.download_last).fromNow()}})</td>
            </tr>
            <tr>
                <td class="col-md-2">First Download</td>
                <td class="col-md-10">{{ moment(dataset.download_first).format('LLL') }} ({{ moment(dataset.download_first).fromNow()}})</td>
            </tr>
            {% if dataset.notes %}
            <tr>
                <td class="col-md-2">Notes</td>
                <td class="col-md-10">{{dataset.notes}}</td>
            </tr>
            {% endif %}
            <tr>
                <td class="col-md-2">Dimensions</td>
                <td class="col-md-10">
                    {% for d in dataset.dimension_list.keys() %}
                        <a href="#dim-{{d}}">{{d}}</a><br/>
                    {% endfor %}
                 </td>
            </tr>            
            <tr>
                <td class="col-md-2">Attributes</td>
                <td class="col-md-10">
                    {% if dataset.attribute_list %}
                    {% for a in dataset.attribute_list.keys() %}
                        <a href="#attr-{{a}}">{{a}}</a><br/>
                    {% endfor %}
                    {% else %}
                        Not Attributes
                    {% endif %}
                 </td>
            </tr>
        </tbody>
    </table>
</div>

{% for dimension, values in dataset.dimension_list.items() %}
<a name="dim-{{dimension}}"></a>
<div class="panel panel-default">
    <div class="panel-heading"><h4>{{ dimension }} <small>(dimension)</small></h4></div>
    <table class="table table-striped table-condensed table-responsive">
        <tbody>
        {% for v in values %}
            <tr>
                <td class="col-md-2">{{v.0}}</td>
                <td class="col-md-10">{{v.1}}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>       
</div>
{% endfor %}

{% for attribute, values in dataset.attribute_list.items() %}
<a name="attr-{{attribute}}"></a>
<div class="panel panel-default">
    <div class="panel-heading"><h4>{{ attribute }} <small>(attribute)</small></h4></div>
    <table class="table table-striped table-condensed table-responsive">
        <tbody>
        {% for v in values %}
            <tr>
                <td class="col-md-2">{{v.0}}</td>
                <td class="col-md-10">{{v.1}}</td>
            </tr>
        {% endfor %}        
        </tbody>
    </table>       
</div>
{% endfor %}

<a name="tags"></a>
<div class="panel panel-default">
    <table class="table table-striped table-condensed table-responsive">
        <tbody>
            <tr>
                <td class="col-md-2">Tags</td>
                <td class="col-md-10">{{dataset.tags|join(", ")}}</td>
            </tr>                        
        </tbody>
    </table>       
</div>

<a id="debug" class="btn btn-default btn-sm" href="#"><i class="fa fa-cog"></i> Debug</a>

<div class="debug" style="display: none">
    <h2>Dataset:</h2>
    <pre id="debug_object"></pre>
</div>

{% endblock %}

{% block add_scripts %}
    {{super()}}
    
    <script type="text/javascript">
    $(document).ready(function(){
        
        $("#debug").click(function(e){
            e.preventDefault();
            if ( $(".debug").is(":visible") ) {
            	$(".debug").toggle();	
            } else {
	 		   	$.ajax({
			        url: "{{ url_for('.dataset', id=dataset._id) }}",
			        cache: false,
			        complete: function(jqXHR, textStatus){
			            if (textStatus == "success"){
			            	$("#debug_object").text(jqXHR.responseJSON);
			            }
			        }
			   	});
	 		   $(".debug").toggle();
            }
        });
        
    });
    </script>
{% endblock %}
    