{% extends "layout.html" %}

{% block title %}{{super()}} - Dataset - {{dataset.dataset_code}}{% endblock %}

{% block breadcrumb %}
    <ol class="breadcrumb">
      <li><a href="{{ url_for("home") }}">Home</a></li>
      <li><a href="{{ url_for("views.providers") }}">Providers</a></li>      
      <li><a href="{{ url_for("views.datasets", slug=provider.slug) }}">{{provider.name}}</a></li>
      <li class="active">{{dataset.dataset_code}}</li>
    </ol>
{% endblock %}

{% block page %}

<a name="home"></a>
<div class="panel panel-default">
    <div class="panel-heading">
    	<div class="row">
	    	<div class="col-md-2">
	        	<h4>{{ provider.name }} - {{ dataset.dataset_code }}</h4>
	        </div>
	        <div class="col-md-10">
				<a href="{{ url_for('.series_by_dataset_slug', slug=dataset.slug) }}" type="button" class="btn btn-success active">
					Series <span class="badge">{{count}}</span>
				</a>
			</div>
  		</div>        
     </div>

	<div class="table-responsive">
    <table class="table table-striped table-condensed">
        <tbody>
            <tr>
                <td class="col-md-2">Provider</td>
                <td class="col-md-10">{{ provider.long_name }}</td>
            </tr>
            <tr>
                <td class="col-md-2">Name</td>
                <td class="col-md-10">{{ dataset.name }}</td>
            </tr>
            <tr>
                <td class="col-md-2">Web Site</td>
                <td class="col-md-10">
                    {% if dataset.doc_href and dataset.doc_href.lower().startswith('http') %}
                        <a target="_blank" href="{{ dataset.doc_href }}">{{ dataset.doc_href }}</a>
                    {% else %}
	                    <a href="{{ provider.website }}">{{ provider.website }}</a>
                    {% endif %}                
                </td>
            </tr>
            {#
            <tr>
                <td class="col-md-2">Export</td>
                <td class="col-md-10">
                    <a title="Export CSV" class="icon" href="{{ url_for('download.datasets_csv', slug=dataset.slug) }}">
                        <i class="fa fa-download fa-lg"></i>
                    </a>                        
                </td>                
            </tr>
            #}
            <tr>
                <td class="col-md-2">Last Updated</td>
                <td class="col-md-10">{{ moment(dataset.last_update).format('LLL') }} ({{ moment(dataset.last_update).fromNow()}})</td>
            </tr>
            <tr>
                <td class="col-md-2">Last Download</td>
                <td class="col-md-10">{{ moment(dataset.download_last).format('LLL') }} ({{ moment(dataset.download_last).fromNow()}})</td>
            </tr>
            <tr>
                <td class="col-md-2">First Download</td>
                <td class="col-md-10">{{ moment(dataset.download_first).format('LLL') }} ({{ moment(dataset.download_first).fromNow()}})</td>
            </tr>
            {% if dataset.notes %}
            <tr>
                <td class="col-md-2">Notes</td>
                <td class="col-md-10">{{dataset.notes}}</td>
            </tr>
            {% endif %}
            <tr>
                <td class="col-md-2">Dimensions</td>
                <td class="col-md-10">
                    {% for d in dataset.dimension_keys %}
                        <a href="#dim-{{d}}">{{dataset.concepts[d]}}</a><br/>
                    {% endfor %}
                 </td>
            </tr>            
            <tr>
                <td class="col-md-2">Attributes</td>
                <td class="col-md-10">
                    {% if dataset.attribute_keys %}
                    {% for a in dataset.attribute_keys %}
                        <a href="#attr-{{a}}">{{dataset.concepts[a]}}</a><br/>
                    {% endfor %}
                    {% else %}
                        None
                    {% endif %}
                 </td>
            </tr>
        </tbody>
    </table>
    </div>
</div>

{% for key in dataset.dimension_keys %}
{% set dimension = dataset.codelists[key] %}
<a name="dim-{{key}}"></a>
<div class="panel panel-default">
    <div class="panel-heading"><h4>{{ dataset.concepts[key] }} <small>(dimension)</small></h4></div>
    <div class="table-responsive">
    <table class="table table-striped table-condensed table-responsive">
        <tbody>
        {% for key, value in dimension.items() %}
            <tr>
                <td class="col-md-2">{{key}}</td>
                <td class="col-md-10">{{value}}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
</div>
{% endfor %}

{% for key in dataset.attribute_keys %}
{% set attribute = dataset.codelists[key] %}
<a name="attr-{{key}}"></a>
<div class="panel panel-default">
    <div class="panel-heading"><h4>{{ dataset.concepts[key] }} <small>(attribute)</small></h4></div>
    <table class="table table-striped table-condensed table-responsive">
        <tbody>
        {% for key, value in attribute.items() %}
            <tr>
                <td class="col-md-2">{{key}}</td>
                <td class="col-md-10">{{value}}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>       
</div>
{% endfor %}

<a name="tags"></a>
<div class="panel panel-default">
    <table class="table table-striped table-condensed table-responsive">
        <tbody>
            <tr>
                <td class="col-md-2">Tags</td>
                <td class="col-md-10">{{dataset.tags|join(", ")}}</td>
            </tr>                        
        </tbody>
    </table>       
</div>

<a id="debug" class="btn btn-default btn-sm" href="#"><i class="fa fa-cog"></i> Debug</a>

<div class="debug" style="display: none">
    <h2>Dataset:</h2>
    <pre id="debug_object"></pre>
</div>

{% endblock %}

{% block add_scripts %}
    {{super()}}
    
    <script type="text/javascript">
    $(document).ready(function(){
        
        $("#debug").click(function(e){
            e.preventDefault();
            if ( $(".debug").is(":visible") ) {
            	$(".debug").toggle();	
            } else {
	 		   	$.ajax({
			        url: "{{ url_for('.dataset-by-slug', slug=dataset.slug) }}",
			        cache: false,
			        complete: function(jqXHR, textStatus){
			            if (textStatus == "success"){
			            	$("#debug_object").text(jqXHR.responseJSON);
			            }
			        }
			   	});
	 		   $(".debug").toggle();
            }
        });
        
    });
    </script>
{% endblock %}
    